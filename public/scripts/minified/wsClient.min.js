const wsc=new WebSocket("ws://"+window.location.host+"/chat"),form=document.querySelector("form"),input=document.querySelector("#msg-input"),msgArea=document.querySelector(".msg-area");let pseudo="",connectedUsers=[];function playSound(url){const audio=new Audio(url);audio.play()}function sendMsg(txt){wsc.send(JSON.stringify({event:"message",payload:txt,author:pseudo}))}form.addEventListener("submit",e=>{e.preventDefault();const txt=input.value;txt.length>0&&(sendMsg(txt),input.value="")}),setInterval(()=>{wsc.send(JSON.stringify({event:"ping"}))},29e3),wsc.addEventListener("close",()=>{console.log("disconnected"),window.location.replace("/logout")}),wsc.addEventListener("message",msg=>{const data=JSON.parse(msg.data);if("pong"!==data.event){if("message"===data.event){playSound("../../sounds/soap.mp3");let card=document.createElement("div");card.className="msg-card";let cardPseudo=document.createElement("span"),cardMsg=document.createElement("p");cardPseudo.innerText=`${data.author} â†’ `,card.appendChild(cardPseudo),cardMsg.innerText=data.payload,card.appendChild(cardMsg),msgArea.appendChild(card),msgArea.scrollTop=msgArea.scrollHeight-msgArea.clientHeight}"pseudo"===data.event&&(pseudo=data.payload),"connectedUsers"===data.event&&(playSound("../../sounds/popalert.mp3"),showConnectedUsers(data.payload))}});